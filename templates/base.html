<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>{% block title %}Expense Tracker{% endblock %}</title>

<style>
/* ---------- THEME VARIABLES ---------- */
:root {
  --primary:#6366f1;
  --accent:#0ea5e9;
  --accent-2:#22c55e;

  --danger:#dc2626;
  --nav-bg:#ffffff;
  --border:#e5e7eb;

  --text-main:#111827;
  --text-muted:#6b7280;

  --page-bg-1:#eef2ff;
  --page-bg-2:#e0f2fe;

  --card-bg:#ffffff;
}

[data-theme="dark"]{
  --primary:#818cf8;
  --accent:#38bdf8;
  --accent-2:#4ade80;

  --nav-bg:#0f172a;
  --card-bg:#111827;
  --border:#1f2937;

  --text-main:#e5e7eb;
  --text-muted:#9ca3af;

  --page-bg-1:#020617;
  --page-bg-2:#020617;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:"Segoe UI",Tahoma,Verdana,sans-serif;
  background:linear-gradient(135deg,var(--page-bg-1),var(--page-bg-2));
  color:var(--text-main);
  min-height:100vh;
}

/* ---------- NAVBAR ---------- */
.navbar{
  height:72px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 20px;
  background:var(--nav-bg);
  border-bottom:3px solid;
  border-image:linear-gradient(90deg,var(--primary),var(--accent),var(--accent-2)) 1;
  box-shadow:0 6px 14px rgba(0,0,0,.12);
}

.logo{
  font-size:20px;
  font-weight:800;
  background:linear-gradient(90deg,var(--primary),var(--accent));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* NAV LINKS */
.nav-links{
  display:flex;
  gap:18px;
  align-items:center;
}

.nav-links a{
  text-decoration:none;
  color:var(--text-muted);
  font-weight:600;
  font-size:14px;
}

.nav-links a:hover{color:var(--primary)}
.nav-links .delete{color:#dc2626}

/* THEME SELECT */
.theme-select{
  border:1px solid var(--border);
  background:transparent;
  padding:6px 10px;
  border-radius:8px;
  font-size:13px;
  color:var(--text-muted);
}

/* ---------- PROFILE DROPDOWN ---------- */
.profile-wrapper{position:relative}

.profile-btn{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--card-bg);
  cursor:pointer;
}

.avatar{
  width:30px;
  height:30px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:900;
}

.profile-menu{
  position:absolute;
  right:0;
  top:44px;
  background:var(--card-bg);
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow:0 20px 40px rgba(0,0,0,.25);
  display:none;
  min-width:170px;
}

.profile-menu.open{display:block}

.profile-menu a{
  display:block;
  padding:12px;
  text-decoration:none;
  color:var(--text-main);
  font-weight:600;
}

.profile-menu a:hover{
  background:rgba(99,102,241,.12);
}

/* ---------- MODAL ---------- */
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}

.modal{
  background:var(--card-bg);
  border-radius:18px;
  padding:26px;
  width:360px;
  box-shadow:0 30px 60px rgba(0,0,0,.35);
  animation:fade .25s ease;
}

@keyframes fade{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}

.modal h3{
  margin:0 0 14px;
  font-size:18px;
  font-weight:900;
}

.modal input{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid var(--border);
  margin-bottom:10px;
  background:var(--card-bg);
  color:var(--text-main);
}

.btn-row{
  display:flex;
  gap:10px;
  justify-content:flex-end;
  margin-top:6px;
}

.btn{
  padding:8px 14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-weight:700;
}

.primary{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff}
.secondary{background:transparent;border:1px solid var(--border)}
</style>
</head>

<body>

<nav class="navbar">
  <div class="logo">üí∞ ExpenseTracker</div>

  <div class="nav-links">
    <a href="/ExpenseTracker/Home">Home</a>
    <a href="/ExpenseTracker/AddExpense">Add Expense</a>
    <a href="/ExpenseTracker/GetExpenses">View Expenses</a>
    <a href="/ExpenseTracker/DeleteOldExpenses" class="delete">Delete</a>

    <select id="themeSelect" class="theme-select" onchange="applyTheme(this.value)">
      <option value="system">üñ•Ô∏è System</option>
      <option value="light">‚òÄÔ∏è Bright</option>
      <option value="dark">üåô Dark</option>
    </select>

    <div class="profile-wrapper">
      <button class="profile-btn" onclick="toggleProfile(event)">
        <div class="avatar">{{ username[0]|upper }}</div>
        {{ username }}
      </button>

      <div class="profile-menu" id="profileMenu">
        <a onclick="openProfile()">‚úèÔ∏è Edit Profile</a>
        <a onclick="openPwd()">üîë Change Password</a>
        <a href="/ExpenseTracker/logout" style="color:#dc2626">üö™ Logout</a>
      </div>
    </div>
  </div>
</nav>

<div class="container">
  {% block content %}{% endblock %}
</div>

<!-- ---------- EDIT PROFILE MODAL ---------- -->
<div class="modal-backdrop" id="profileModal">
  <div class="modal">
    <h3>‚úèÔ∏è Edit Profile</h3>
    <form method="POST" action="/ExpenseTracker/EditProfile">
      <input name="new_name" value="{{ username }}" required>
      <div class="btn-row">
        <button type="button" class="secondary btn" onclick="closeModals()">Cancel</button>
        <button class="primary btn">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- ---------- CHANGE PASSWORD MODAL ---------- -->
<div class="modal-backdrop" id="pwdModal">
  <div class="modal">
    <h3>üîë Change Password</h3>
    <form method="POST" action="/ExpenseTracker/ChangePassword">
      <input type="password" name="old_pass" placeholder="Old Password" required>
      <input type="password" name="new_pass" placeholder="New Password" required>
      <div class="btn-row">
        <button type="button" class="secondary btn" onclick="closeModals()">Cancel</button>
        <button class="primary btn">Update</button>
      </div>
    </form>
  </div>
</div>

<script>
function toggleProfile(e){
  e.stopPropagation();
  document.getElementById("profileMenu").classList.toggle("open");
}
document.addEventListener("click",()=>document.getElementById("profileMenu").classList.remove("open"));

function openProfile(){closeModals();document.getElementById("profileModal").style.display="flex";}
function openPwd(){closeModals();document.getElementById("pwdModal").style.display="flex";}
function closeModals(){document.getElementById("profileModal").style.display="none";document.getElementById("pwdModal").style.display="none";}

/* THEME */
const mq=window.matchMedia("(prefers-color-scheme: dark)");
function setSystem(){document.body.dataset.theme=mq.matches?"dark":"light";}
function applyTheme(m){localStorage.setItem("theme-mode",m);
  document.getElementById("themeSelect").value=m;
  if(m==="system"){setSystem();mq.addEventListener("change",setSystem);}
  else{mq.removeEventListener("change",setSystem);document.body.dataset.theme=m;}
}
applyTheme(localStorage.getItem("theme-mode")||"system");
</script>

</body>
</html>
